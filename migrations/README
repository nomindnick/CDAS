# Database Migrations

This directory contains database migrations for the Construction Document Analysis System.

## Overview

We use Alembic for managing database migrations. Alembic is an SQLAlchemy-based database migration tool that allows us to:
- Track changes to the database schema
- Generate migration scripts automatically
- Apply migrations to upgrade the database
- Downgrade to a previous version if needed

## Usage

### Creating a new migration

After making changes to SQLAlchemy models in `cdas/db/models.py`, generate a new migration:

```bash
alembic revision --autogenerate -m "Description of the changes"
```

This will create a new migration script in the `versions` directory.

### Upgrading the database

To apply all pending migrations and upgrade the database to the latest version:

```bash
alembic upgrade head
```

### Downgrading the database

To downgrade to a previous version:

```bash
alembic downgrade <revision>
```

Where `<revision>` is the revision identifier or a relative identifier like `-1` for one revision back.

### Getting migration information

To see the current database version:

```bash
alembic current
```

To see the migration history:

```bash
alembic history
```

## Configuration

Alembic configuration is stored in `alembic.ini` at the project root. Database connection settings are loaded from the CDAS configuration in the `env.py` file.

## Best Practices

1. Always review autogenerated migration scripts before applying them
2. Test migrations on development databases before production
3. Include both upgrade and downgrade paths
4. Use descriptive commit messages when generating migrations
5. Run migrations as part of your deployment process